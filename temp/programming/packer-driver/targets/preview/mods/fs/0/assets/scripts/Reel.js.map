{"version":3,"sources":["file:///Users/fe-minhthao/Documents/test/PromiseExample/assets/scripts/Reel.ts"],"names":["_decorator","Component","Vec3","ccclass","property","Reel","startSpin","Promise","resolve","reject","_rollTarget","Math","round","random","_spinning","_rollCount","_rollY","reelSpeed","_direction","_reelStopCB","node","setPosition","position","x","setTimeout","update","dt","deltaY","abs","y","_symbolHeight","swapSymbol","lastSymbolIndex","children","length","lastSymbol","setSiblingIndex"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, Node, Vec3, Vec2 } from 'cc';\nconst { ccclass, property } = _decorator;\n \n@ccclass('Reel')\nexport class Reel extends Component {\n\n    _symbolHeight = 125;\n    _rollTarget = 0;\n    _rollCount = 0;\n    _rollY = 0;\n    _spinning = false;\n    _direction = 1;\n    _reelStopCB = null;\n\n    @property\n    reelSpeed = 100;\n\n    startSpin() {\n        return new Promise((resolve,reject) =>{\n            this._rollTarget = Math.round(Math.random() * 20 + 50);\n            this._spinning = true;\n            this._rollCount = 0;\n            this._rollY = 0;\n            this.reelSpeed = Math.random()*500 + 700;\n            this._direction = (Math.random() > 0.5) ? 1 : -1;\n            this._reelStopCB = ()=>{\n                this.node.setPosition(new Vec3(this.node.position.x, 0, 0));\n                // callback && callback();\n                resolve(true)\n            }\n\n            setTimeout(reject,10000);\n        });\n    }\n\n    update(dt) {\n        if (this._spinning) {\n            let deltaY = this.reelSpeed * dt * this._direction;\n            this._rollY += Math.abs(deltaY);\n            this.node.setPosition(new Vec3(this.node.position.x, this.node.position.y - deltaY, 0));\n            if (this._rollY >= this._symbolHeight) {\n                this.node.setPosition(new Vec3(this.node.position.x, this.node.position.y + this._symbolHeight * this._direction, 0));\n                this.swapSymbol();\n                this._rollY -= this._symbolHeight;\n                this._rollCount += 1;\n                if (this._rollCount >= this._rollTarget) {\n                    this._spinning = false;\n                    this._reelStopCB && this._reelStopCB();\n                }\n            }\n        }\n    }\n\n    swapSymbol() {\n        let lastSymbolIndex = (this._direction == 1) ? this.node.children.length-1 : 0;\n        let lastSymbol = this.node.children[lastSymbolIndex];\n\n        if (this._direction == 1) {\n            lastSymbol.setSiblingIndex(0);\n        }\n        else {\n            lastSymbol.setSiblingIndex(this.node.children.length);\n        }\n    }\n}\n"]}